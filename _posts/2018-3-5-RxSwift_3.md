---
layout:     post
title:      "RxSwift. 기초 정리하기 (3)"
subtitle:   "Operator 기초를 정리해보자, Transforming Operators, toArray, map, mapWithIndex, flatMap, flatMapLatest"
date:       2018-03-05 00:00:00
author:     "MinJun"
header-img: "img/tags/RxSwift-bg.jpg"
comments: true 
tags: [RxSwift]
---

Raywenderlich-Ebook의 RxSwift를 읽고 정리한 내용입니다.
아래 내용의 저작권과 이미지는 모두 [https:/www.raywenderlich.com/](https://www.raywenderlich.com/) 에 있습니다. 더 자세한 내용은 [여기서 책을 구입해주세요!](https://store.raywenderlich.com/products/rxswift)

---


## RxSwift 정리 (3) 

- Transforming Operators
	- toArray
	- map
	- mapWithIndex
	- Transforming inner observables 
		- flatMap
		- flatMapLatest
- Reference 

---

## Transforming Operators 

---

#### - toArray 

Observables은 요소들을 개별적으로 방출하지만, 요소들은 TableView, CollectionView와 사용되는 경우가 많이 있습니다. 그럴때 각 요소들을 Array에 바인딩 하기 편한 방법은 toArray를 사용하는것입니다 <br>

<center><img src="/img/posts/Transforming_Operators.png" width="700" height="350"></center> <br> 

```swift
let bag = DisposeBag()
Observable.of(1, 2, 3, 4)
	.toArray()
	.subscribe {
		print($0) // [1, 2, 3, 4 ], type -> [Int]
	}
	.disposed(by: bag)
```

---

### - map

Swift의 map이랑 비슷하게 각 요소에 동작을 합니다.

<center><img src="/img/posts/Transforming_Operators-1.png" width="700" height="350"></center> <br> 

```swift
let bag = DisposeBag()
let formatter = NumberFormatter()
formatter.numberStyle = .spellOut // 숫자를 받아서 -> 영어스팰링으로
Observable<NSNumber>.of(123, 4, 56)
	.map {
		formatter.string(from: $0) ?? ""
		}
	.subscribe(onNext: {
		print($0) // one hundred twenty-three -> four -> fifty-six
		})
	.disposed(by: bag)
```

---

### - mapWithIndex 

filtering operator의 `withIndex`와 비슷하게 작동함, 값과, 인덱스(순서)를 파라미터로 받아서 처리해줄수 있습니다. <br>

<center><img src="/img/posts/Transforming_Operators-2.png" width="700" height="350"></center> <br> 

```swift
Observable.of(1, 2, 3, 4, 5)
            .mapWithIndex({ v, i in
                i > 1 ? v * 2 : v
            })
            .subscribe(onNext:{
                print($0) // 1 2 6 8 10
            })
        .disposed(by: bag)
```

---

## Transforming inner observables 


#### - flatmap

The documentation for flatMap describes that it “Projects each element of an observable sequence to an observable sequence and merges the resulting observable sequences into one observable sequence. 

Observable sequence를 다른 observables sequence에 투영하고 그 결과를 하나의 observable sequence에 병합합니다.

쉽게 이야기해서, 여러가지 Observables의 값들을 다른 Observables에 방출할수 있고, 그것들을 하나로 바인딩 할수 있다는 말! <vr>

<center><img src="/img/posts/Transforming_Operators-4.png" width="700" height="350"></center> <br> 

```swift
	 struct Student {
			var score: Variable<Int>
    }
    
    let bag = DisposeBag()
    
    let ryan = Student(score: Variable(80))
    let charlotte = Student(score: Variable(90))
    let student = PublishSubject<Student>()

    student.asObservable()
        
        .flatMap{
            $0.score.asObservable() // 점수를 수정하지말고 그냥 통과하라고함
        }
        .subscribe(onNext: {
            print($0)
        })
        .disposed(by: bag)
    student.onNext(ryan) // 80
    ryan.score.value = 85 // 85
    student.onNext(charlotte) // 90
    ryan.score.value = 90 // 90
    charlotte.score.value = 100 // 100
    
    // 값도 변경 되었내.
    print(ryan.score.value, charlotte.score.value)
    // 해당 값들을 바꾸니까, 실시간으로 바꾼 값을 출력해줌..
```

각 요소의 값들을 다른 Observable로 만들고, 그 값들을 마지막에 하나로 바인딩했습니다.

---

### - flatMapLatest

flatMapLatest는 새로운 Observable을 만들고, 새로운 Observable이 동작하는 중에 새로 발행된 아이템이 전달되면, 만들어진 Observable은 dispose하고 새로운 Observable을 만듭니다. <br>

<center><img src="/img/posts/Transforming_Operators-5.png" width="700" height="350"></center> <br> 

```swift
    struct Student {
        var score: Variable<Int>
    }
    
    let bag = DisposeBag()
    
    let ryan = Student(score: Variable(80))
    let charlotte = Student(score: Variable(90))
    let student = PublishSubject<Student>()

    student.asObservable()
        
        .flatMapLatest{
            $0.score.asObservable() // 점수를 수정하지말고 그냥 통과하라고함
        }
        .subscribe(onNext: {
            print($0)
        })
        .disposed(by: bag)
    
    student.onNext(ryan) // 80
    ryan.score.value = 85 // 85
    student.onNext(charlotte) // 90
    
    
    ryan.score.value = 95 // 출력안됨.
    charlotte.score.value = 100 // 100
    ryan 의 score를 다시 출력하고 싶다면
    	-> student.onNext(ryan) 하게된다면, 다시 ryan의 점수들을 출력합니다. 
```

---

## Reference 

* 공식 

[http://reactivex.io](http://reactivex.io/documentation/ko/observable.html) <br> 
[Getting Started Rxswift](https://github.com/ReactiveX/RxSwift/blob/master/Documentation/GettingStarted.md#observables-aka-sequences) <br>
[Introduce to Rx](http://www.introtorx.com/Content/v1.0.10621.0/00_Foreword.html) <br>
[RxJS Marbles](http://rxmarbles.com/) <br>
[RxSwift github](https://github.com/ReactiveX/RxSwift) <br>
[http://community.rxswift.org/](http://community.rxswift.org/) <br>

* 일반 참조 

[[ReactiveX][RxSwift]flatMap, flatMapFirst, flatMapLatest](http://minsone.github.io/programming/reactive-swift-flatmap-flatmapfirst-flatmaplatest) <br>
[RxSwift Observable의 변형](https://brunch.co.kr/@tilltue/9)

---






















